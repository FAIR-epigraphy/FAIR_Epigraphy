<!--<link href="css/yasgui.min.css" rel="stylesheet" />-->
<!--<script src="js/yasgui.min.js"></script>-->
<!--<link href="css/yasgui-pro.min.css" rel="stylesheet" />
<script src="js/yasgui-pro.min.js"></script>-->
<style>
    .yasgui .controlbar {
        display: none !important;
    }

    .yasr_external_ref_btn {
        display: none !important;
    }
</style>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div id="yasgui"></div>
        </div>
    </div>
</div>

<!--<script src="js/n3.min.js"></script>
<script src="js/comunica-browser.js"></script>-->

<script>
    //////////////////////////////////////////////////////////////////
    /// Load data
    const { DataFactory } = N3;
    const { namedNode, literal, defaultGraph, quad } = DataFactory;
    var store = new N3.Store();
    const yasgui = new Yasgui(document.getElementById("yasgui"), {
        requestConfig: {
            endpoint: "",
            method: ''
        },
        copyEndpointOnNewTab: false,

    });

    yasgui.selectTabId().yasqeWrapperEl.getElementsByClassName('yasqe_queryButton')[0].addEventListener('click', runQuery)

    document.getElementsByClassName('addTab')[0].addEventListener('click', (e) => {
        yasgui.selectTabId().yasqeWrapperEl.getElementsByClassName('yasqe_queryButton')[0].addEventListener('click', runQuery)
    })

    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            yasgui.selectTabId().yasqeWrapperEl.getElementsByClassName('yasqe_queryButton')[0].addEventListener('click', runQuery)
        })
    })

    async function runQuery(e) {
        let myEngine = new Comunica.QueryEngine();

        const result = await myEngine.query(yasgui.selectTabId().yasqe.getValue(), {
            sources: [store],
        });
        var json = '';
        const { data } = await myEngine.resultToString(result, 'application/sparql-results+json');

        data.on('data', (d) => {
            //console.log(d);
            json += d.toString();
            return d.toString()
        })

        data.on('end', () => {
            //console.log(json)
            yasgui.selectTabId().yasr.setResponse({
                data: json,
                contentType: "application/sparql-results+json",
                status: 200,
                executionTime: 1000, // ms
                // error to show
            })
        })
    }
    fetch("data/data.txt").then(function (response) {
        return response
    }).then(function (data) {
        return data.text()
    }).then(function (dataset) {
        const parser = new N3.Parser();
        parser.parse(dataset,
            (error, quaad, prefixes) => {
                if (quaad) {
                    //console.log(quad);
                    store.addQuad(
                        quaad.subject,
                        quaad.predicate,
                        quaad.object,
                        //namedNode(graph)
                    )
                }
                else {
                    /////////////////////////////////////////////////
                    console.log(prefixes)
                }

            });
    }).catch(function (err) {
        console.log('Fetch problem show: ' + err.message);
    });
    ////////////////////////////////////////////////////////////////////////
   
</script>