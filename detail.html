<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css" integrity="sha384-eoTu3+HydHRBIjnCVwsFyCpUDZHZSFKEJD0mc3ZqSBSb6YhZzRHeiomAUWCstIWo" crossorigin="anonymous">

    <link href="css/style.css" rel="stylesheet" />
</head>
<body>
    <div class="row">
        <div class="col-md-12">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title" id="ins_id"></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" id="map" style="height: 50vh;"></div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-4">
                        <table class="table table-hover">
                            <tr>
                                <th>
                                    Trismegistos ID:
                                </th>
                                <td>
                                    <label id="tmId"></label>
                                </td>
                            </tr>
                            <tr>
                                <th>Material:</th>
                                <td>
                                    <label id="material"></label>
                                </td>
                            </tr>
                            <tr>
                                <th>Object Type:</th>
                                <td>
                                    <label id="objectType"></label>
                                </td>
                            </tr>
                            <tr>
                                <th>Language:</th>
                                <td>
                                    <label id="language"></label>
                                </td>
                            </tr>
                            <tr>
                                <th>Same As/Close Match:</th>
                                <td>
                                    <a href="javascript:void(0)" class="text-decoration-none">http:xyz/dummy</a> <br />
                                    <a href="javascript:void(0)" class="text-decoration-none">http:xyz/dummy1</a><br />
                                    <a href="javascript:void(0)" class="text-decoration-none">http:xyz/dummy2</a><br />
                                    <a href="javascript:void(0)" class="text-decoration-none">http:xyz/dummy3</a><br />
                                </td>
                            </tr>
                        </table>

                    </div>
                    <div class="col-md-8">
                        <button class="btn btn-primary form-control" type="button" id="btnText">
                            Show Inscription Text
                        </button>
                        <div class="mt-3" style="display: none;" id="divInsText">
                            <!--<b>Text</b>-->
                            <div class="card card-body">
                                <p id="inc_text">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>

    <!--<script src="//maps.googleapis.com/maps/api/js?libraries=geometry,visualization,places&amp;language=en&amp;v=3.23&amp;key=AIzaSyAsmeOloQ8Bgw413D9YoLEGbmQefPIBYcg"></script>-->
    <!--<script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?key=AnOaryydl-Jd2yCFF8jL91x2YYdv9KxzJNRMfeea8dVaGSZcBGTgKxoaZd8jckDG'></script>-->
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>


    <!-- RDF Library -->
    <script src="js/n3-browser.js"></script>

    <!-- Custome Javascript files-->
    <script src="js/Utility.js"></script>
    <script>
        //localStorage.removeItem('jsonObj');
        const inscription = JSON.parse(localStorage.getItem('jsonObj'));
        $('#ins_id').html(`<a href="${inscription.inscriptionURI}" target="_blank">${getInscriptionId(inscription.inscriptionId)}: ${inscription.inscriptionLabel}</a>`);
        $('#tmId').html(`${getTrismegistosID(inscription.tmId)}`);
        $('#material').html(`${getMaterial(inscription.materialLink, inscription.material)}`);
        $('#objectType').html(`${getObjectType(inscription.objTypeLink, inscription.objectType)}`);
        $('#language').html(`${getLanguageName(inscription.language)}`);
        $('#inc_text').html(`<pre>${inscription.inscriptionText.replace('Text', '')}</pre>`);
        ////////////////////////////////////////////////////////////
        /// Show/Hide Inscription Text
        $('#btnText').click(() => {
            if ($('#divInsText').attr('style') === 'display: none;') {
                $('#divInsText').show('fade');
                $('#btnText').html('Hide Inscription Text')
            }
            else {
                $('#divInsText').hide('fade');
                $('#btnText').html('Show Inscription Text')
            }
        })

        ///////////////////////////////////////////////////////////////////////
        //// Show Map
        initMap();

        function initMap() {
            if (inscription.geo !== undefined) {
                let lat_lng = inscription.geo.split(',')
                const myLatLng = { lat: parseFloat(lat_lng[0]), lng: parseFloat(lat_lng[1]) };
                const map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 10,
                    center: myLatLng,
                });

                new google.maps.Marker({
                    position: myLatLng,
                    map,
                    title: "Hello World!",
                });

                let interval = setInterval(() => {
                    if (map !== undefined) {
                        google.maps.event.trigger(map, 'resize')
                        clearInterval(interval);
                    }
                }, 500);

            }
            else {
                setTimeout(() => {
                    var map = new Microsoft.Maps.Map('#map');
                    let searchManager;
                    loadModuleMap(searchManager, map);
                }, 400)
            }
        }


        function loadModuleMap(searchManager, map) {
            if (!searchManager) {
                Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
                    searchManager = new Microsoft.Maps.Search.SearchManager(map);
                    loadModuleMap(searchManager, map);
                })
            }
            else {
                //let map = new Microsoft.Maps.Map('#map');
                map.entities.clear();
                let searchRequest = {
                    where: inscription.geoName,
                    callback: function (r) {
                        if (r.results) {

                            let pin = new Microsoft.Maps.Pushpin(r.results[0].location);
                            map.entities.push(pin);
                            map.setView({
                                bounds: r.results[0].bestView,
                                //zoom: 9
                            });
                            //map.setView({ zoom: 10 });
                        }
                    }
                };

                searchManager.geocode(searchRequest);
            }
        }
    </script>
</body>
</html>